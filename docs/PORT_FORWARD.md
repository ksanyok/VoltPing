# Port Forwarding –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tuya

–¶—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–ø–∏—Å—É—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Port Forwarding –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Tuya –ø—Ä–∏—Å—Ç—Ä–æ—é —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.

## ü§î –ù–∞–≤—ñ—â–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ?

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –ª–æ–∫–∞–ª—å–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Tuya –ø—Ä–∏—Å—Ç—Ä–æ—é –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –≤ —Ç—ñ–π —Å–∞–º—ñ–π –º–µ—Ä–µ–∂—ñ (LAN). –Ø–∫—â–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –∑ VoltPing –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —ñ–Ω—à—ñ–π –º–µ—Ä–µ–∂—ñ (VPS, —Ö–æ—Å—Ç–∏–Ω–≥), –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Port Forwarding.

**–°—Ö–µ–º–∞:**
```
[VoltPing Server] ‚Üí [Internet] ‚Üí [–í–∞—à —Ä–æ—É—Ç–µ—Ä:6668] ‚Üí [–†–æ–∑–µ—Ç–∫–∞ Tuya:6668]
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è

Port Forwarding –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –≤–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –¶–µ –≤—ñ–¥–Ω–æ—Å–Ω–æ –±–µ–∑–ø–µ—á–Ω–æ, –æ—Å–∫—ñ–ª—å–∫–∏:
- –ü—Ä–æ—Ç–æ–∫–æ–ª Tuya —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π (AES-128)
- –ü–æ—Ç—Ä—ñ–±–µ–Ω Local Key –¥–ª—è –¥–æ—Å—Ç—É–ø—É
- –ü—Ä–∏—Å—Ç—Ä—ñ–π –Ω–µ –ø—Ä–∏–π–º–∞—î –∫–æ–º–∞–Ω–¥–∏ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞

–ê–ª–µ –≤—Å–µ –∂ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –ø–æ—Ä—Ç
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ firewall –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –ª–∏—à–µ –∑ IP —Å–µ—Ä–≤–µ—Ä–∞

## üìã –ö—Ä–æ–∫–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–Ω–∞–π–¥—ñ—Ç—å IP –∞–¥—Ä–µ—Å—É —Ä–æ–∑–µ—Ç–∫–∏

```bash
# –°–∫–∞–Ω—É–π—Ç–µ –º–µ—Ä–µ–∂—É
nmap -sP 192.168.1.0/24

# –ê–±–æ –∑–Ω–∞–π–¥—ñ—Ç—å –ø–æ—Ä—Ç 6668
nmap -p 6668 192.168.1.0/24 --open
```

–ê–±–æ —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä ‚Äî –∑–Ω–∞–π–¥—ñ—Ç—å –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –Ω–∞–∑–≤–æ—é —Ç–∏–ø—É "ESP_XXXX".

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ—É—Ç–µ—Ä–∞

#### TP-Link

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `http://192.168.1.1` –∞–±–æ `http://tplinkwifi.net`
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å: **Advanced** ‚Üí **NAT Forwarding** ‚Üí **Port Forwarding** (–∞–±–æ **Virtual Servers**)
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Add**
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å:
   - **Service Type**: Tuya (–∞–±–æ Custom)
   - **External Port**: 6668 (–∞–±–æ —ñ–Ω—à–∏–π)
   - **Internal IP**: 192.168.1.XXX (IP —Ä–æ–∑–µ—Ç–∫–∏)
   - **Internal Port**: 6668
   - **Protocol**: TCP
5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

#### Asus

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `http://router.asus.com` –∞–±–æ `http://192.168.1.1`
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å: **WAN** ‚Üí **Virtual Server / Port Forwarding**
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å **Enable Port Forwarding**: Yes
4. –î–æ–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **Service Name**: Tuya
   - **Port Range**: 6668
   - **Local IP**: 192.168.1.XXX
   - **Local Port**: 6668
   - **Protocol**: TCP
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Apply**

#### Mikrotik

```bash
# –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª
/ip firewall nat add chain=dstnat action=dst-nat to-addresses=192.168.1.XXX to-ports=6668 protocol=tcp dst-port=6668

# –ê–±–æ —á–µ—Ä–µ–∑ WebFig/WinBox:
# IP ‚Üí Firewall ‚Üí NAT ‚Üí Add
# Chain: dstnat
# Protocol: tcp
# Dst. Port: 6668
# Action: dst-nat
# To Addresses: 192.168.1.XXX
# To Ports: 6668
```

#### Keenetic

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `http://my.keenetic.net`
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å: **–ú–µ—Ä–µ–∂–∞** ‚Üí **–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—è –ø–æ—Ä—Ç—ñ–≤**
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **–î–æ–¥–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ**
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å:
   - **–û–ø–∏—Å**: Tuya
   - **–í—Ö—ñ–¥–Ω–∏–π –ø–æ—Ä—Ç**: 6668
   - **IP –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: 192.168.1.XXX
   - **–ü–æ—Ä—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: 6668
   - **–ü—Ä–æ—Ç–æ–∫–æ–ª**: TCP
5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

#### D-Link

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `http://192.168.0.1`
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å: **Advanced** ‚Üí **Port Forwarding**
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Add**
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å:
   - **Name**: Tuya
   - **IP Address**: 192.168.1.XXX
   - **TCP Port**: 6668-6668
   - **UDP Port**: (–∑–∞–ª–∏—à—Ç–µ –ø—É—Å—Ç–∏–º)
5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

### 3. –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –≤–∞—à—É –ø—É–±–ª—ñ—á–Ω—É IP

```bash
curl ifconfig.me
# –∞–±–æ
curl ip.me
```

–ê–±–æ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ [whatismyip.com](https://www.whatismyip.com/)

### 4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Port Forwarding

```bash
# –ó —ñ–Ω—à–æ—ó –º–µ—Ä–µ–∂—ñ (VPS, –º–æ–±—ñ–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç)
nc -zv YOUR_PUBLIC_IP 6668

# –ê–±–æ —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤—ñ—Å
# https://www.yougetsignal.com/tools/open-ports/
```

### 5. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ VoltPing

```env
TUYA_MODE="local"
TUYA_LOCAL_IP="192.168.1.XXX"      # –õ–æ–∫–∞–ª—å–Ω–∞ IP (–¥–ª—è —Ä–µ–∑–µ—Ä–≤—É)
TUYA_PUBLIC_IP="YOUR_PUBLIC_IP"    # –ü—É–±–ª—ñ—á–Ω–∞ IP
TUYA_LOCAL_KEY="your-local-key"
TUYA_LOCAL_VERSION="3.5"
```

VoltPing —Å–ø—Ä–æ–±—É—î –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ `TUYA_PUBLIC_IP` –∞–±–æ `TUYA_LOCAL_IP`.

---

## üîí –î–æ–¥–∞—Ç–∫–æ–≤–∞ –±–µ–∑–ø–µ–∫–∞

### –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –ø–æ IP

–ù–∞ —Ä–æ—É—Ç–µ—Ä—ñ –∞–±–æ —Å–µ—Ä–≤–µ—Ä—ñ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ firewall:

**Mikrotik:**
```bash
/ip firewall filter add chain=forward action=drop protocol=tcp dst-port=6668 src-address=!YOUR_SERVER_IP
```

**iptables (Linux):**
```bash
iptables -I INPUT -p tcp --dport 6668 -s YOUR_SERVER_IP -j ACCEPT
iptables -I INPUT -p tcp --dport 6668 -j DROP
```

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç—É

–ó–∞–º—ñ—Å—Ç—å 6668, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—à–∏–π –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 16668):

**–†–æ—É—Ç–µ—Ä:**
- External Port: 16668
- Internal Port: 6668

**VoltPing (.env):**
```env
TUYA_LOCAL_PORT="16668"
```

### VPN –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

–ó–∞–º—ñ—Å—Ç—å Port Forwarding, –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ VPN –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —ñ –¥–æ–º–∞—à–Ω—å–æ—é –º–µ—Ä–µ–∂–µ—é:

1. **WireGuard** ‚Äî —à–≤–∏–¥–∫–∏–π —ñ –ø—Ä–æ—Å—Ç–∏–π
2. **OpenVPN** ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π —á–∞—Å–æ–º
3. **Tailscale** ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç

–¶–µ –±–µ–∑–ø–µ—á–Ω—ñ—à–µ, –∞–ª–µ —Å–∫–ª–∞–¥–Ω—ñ—à–µ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ.

---

## ‚öôÔ∏è Troubleshooting

### Port Forwarding –Ω–µ –ø—Ä–∞—Ü—é—î

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ NAT loopback**
   - –¢–µ—Å—Ç—É–π—Ç–µ –∑ —ñ–Ω—à–æ—ó –º–µ—Ä–µ–∂—ñ (–º–æ–±—ñ–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç)
   - –î–µ—è–∫—ñ —Ä–æ—É—Ç–µ—Ä–∏ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å loopback

2. **Double NAT**
   - –Ø–∫—â–æ —É –≤–∞—Å –º–æ–¥–µ–º + —Ä–æ—É—Ç–µ—Ä, –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –Ω–∞ –æ–±–æ—Ö
   - –ê–±–æ –ø–µ—Ä–µ–≤–µ–¥—ñ—Ç—å –º–æ–¥–µ–º –≤ bridge mode

3. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä –±–ª–æ–∫—É—î –ø–æ—Ä—Ç–∏**
   - –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–∏–π –ø–æ—Ä—Ç (8080, 8443)
   - –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

4. **Firewall –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ñ**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ firewall
   - –¢–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∫–Ω—ñ—Ç—å –¥–ª—è —Ç–µ—Å—Ç—É

### –î–∏–Ω–∞–º—ñ—á–Ω–∞ IP –∞–¥—Ä–µ—Å–∞

–Ø–∫—â–æ –≤–∞—à–∞ IP –∑–º—ñ–Ω—é—î—Ç—å—Å—è:

1. **DDNS —Å–µ—Ä–≤—ñ—Å** (Dynamic DNS):
   - [No-IP](https://www.noip.com/)
   - [DuckDNS](https://www.duckdns.org/)
   - –í–±—É–¥–æ–≤–∞–Ω–∏–π DDNS –≤ —Ä–æ—É—Ç–µ—Ä—ñ

2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è IP —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:**
```bash
#!/bin/bash
NEW_IP=$(curl -s ifconfig.me)
sed -i "s/TUYA_PUBLIC_IP=.*/TUYA_PUBLIC_IP=\"$NEW_IP\"/" /path/to/.env
```

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

| –ú–µ—Ç–æ–¥ | –õ—ñ–º—ñ—Ç–∏ | –ó–∞—Ç—Ä–∏–º–∫–∞ | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –ë–µ–∑–ø–µ–∫–∞ |
|-------|--------|----------|------------|---------|
| Cloud API | 30k/–º—ñ—Å—è—Ü—å | 5-10 —Å–µ–∫ | ‚≠ê –õ–µ–≥–∫–æ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Local (LAN) | –ù–µ–º–∞—î | 1-2 —Å–µ–∫ | ‚≠ê‚≠ê –°–µ—Ä–µ–¥–Ω—å–æ | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Local + Port Forward | –ù–µ–º–∞—î | 2-3 —Å–µ–∫ | ‚≠ê‚≠ê‚≠ê –°–∫–ª–∞–¥–Ω—ñ—à–µ | ‚≠ê‚≠ê‚≠ê |
| Local + VPN | –ù–µ–º–∞—î | 2-4 —Å–µ–∫ | ‚≠ê‚≠ê‚≠ê‚≠ê –°–∫–ª–∞–¥–Ω–æ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ hybrid —Ä–µ–∂–∏–º ‚Äî local —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π, cloud —è–∫ —Ä–µ–∑–µ—Ä–≤.

```env
TUYA_MODE="hybrid"
```
